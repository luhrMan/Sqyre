# AppImage recipe for Sqyre.
# Run from repo root: appimage-builder --recipe packaging/AppImageBuilder.yml
#
# Prerequisites (on the host or in the build environment):
#   - Go 1.24+, OpenCV, Tesseract, Leptonica, and other build deps (see README Linux section)
#   - appimage-builder: pip install appimage-builder, or use the AppImage from releases

version: 1
script:
  - cd "$SOURCE_DIR/../../../.."
  - go build -trimpath -o "$TARGET_APPDIR/usr/bin/sqyre" ./cmd/sqyre
  - install -Dm00644 internal/assets/icons/sqyre.png "$TARGET_APPDIR/usr/share/icons/hicolor/256x256/apps/com.sqyre.app.png"
  - install -Dm00644 .devcontainer/builds/linux/packaging/com.sqyre.app.desktop "$TARGET_APPDIR/usr/share/applications/com.sqyre.app.desktop"

AppDir:
  path: "{{ TARGET_APPDIR }}"
  app_info:
    id: com.sqyre.app
    name: Sqyre
    icon: com.sqyre.app
    version: "0.5.0"
    exec: usr/bin/sqyre
    exec_args: "$@"
  # Bundle runtime libs if your distro provides them (optional; appimage-builder may trace the binary)
  # apt:
  #   include:
  #     - libopencv-core4
  #     - libtesseract5
  #   sources:
  #     - sourceline: "deb http://archive.ubuntu.com/ubuntu jammy main universe"
  #       key_url: "http://keyserver.ubuntu.com/pks/lookup?op=get&search=0x3b4fe6acc0b21f32"

AppImage:
  arch: x86_64
  file_name: Sqyre-0.5.0-x86_64.AppImage
